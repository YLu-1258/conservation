{% extends "base.html" %}

{% block title %}Wildlife Conservation{% endblock %}

{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/grid.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modal.css') }}">
{% endblock %}

{% block sidebar %}

{% endblock %}

{% block header %}
    <div>
        <h1 class="line-1 anim-typewriter">
            Missions
        </h1>
    </div>
    <script>
        const textElement = document.querySelector('.line-1');

        textElement.addEventListener('animationend', () => {
        textElement.classList.add('hide-cursor');
        });
    </script>
    
    
{% endblock %}  

{% block content %}

<i class="fas fa-chevron-left" style="color: #ffffff;" onclick="null" id="left-button"></i>
<div class="grid">
    <div class="grid-item" id="mission0" data-mission-id="0">
        <div class="small-flex-container meta-info">
            <div class="small-flex-item point-value"></div>
            <div class="small-flex-item advisor-name"></div>
        </div>
        <div class="vl"></div>
        <div class="small-flex-container main-mission">
            <div class="small-flex-item mission-name"></div>
            <div class="small-flex-item mission-description"></div>
        </div>
    </div>
    <div class="grid-item" id="mission1" data-mission-id="0">
        <div class="small-flex-container meta-info">
            <div class="small-flex-item point-value"></div>
            <div class="small-flex-item advisor-name"></div>
        </div>
        <div class="vl"></div>
        <div class="small-flex-container main-mission">
            <div class="small-flex-item mission-name"></div>
            <div class="small-flex-item mission-description"></div>
        </div>
    </div>
    <div class="grid-item" id="mission2" data-mission-id="0">
        <div class="small-flex-container meta-info">
            <div class="small-flex-item point-value"></div>
            <div class="small-flex-item advisor-name"></div>
        </div>
        <div class="vl"></div>
        <div class="small-flex-container main-mission">
            <div class="small-flex-item mission-name"></div>
            <div class="small-flex-item mission-description"></div>
        </div>
    </div>
    <div class="grid-item" id="mission3" data-mission-id="0">
        <div class="small-flex-container meta-info">
            <div class="small-flex-item point-value"></div>
            <div class="small-flex-item advisor-name"></div>
        </div>
        <div class="vl"></div>
        <div class="small-flex-container main-mission">
            <div class="small-flex-item mission-name"></div>
            <div class="small-flex-item mission-description"></div>
        </div>
    </div>
    <div class="grid-item" id="mission4" data-mission-id="0">
        <div class="small-flex-container meta-info">
            <div class="small-flex-item point-value"></div>
            <div class="small-flex-item advisor-name"></div>
        </div>
        <div class="vl"></div>
        <div class="small-flex-container main-mission">
            <div class="small-flex-item mission-name"></div>
            <div class="small-flex-item mission-description"></div>
        </div>
    </div>
    <div class="grid-item" id="mission5" data-mission-id="0">
        <div class="small-flex-container meta-info">
            <div class="small-flex-item point-value"></div>
            <div class="small-flex-item advisor-name"></div>
        </div>
        <div class="vl"></div>
        <div class="small-flex-container main-mission">
            <div class="small-flex-item mission-name"></div>
            <div class="small-flex-item mission-description"></div>
        </div>
    </div>
    <div class="grid-item" id="mission6" data-mission-id="0">
        <div class="small-flex-container meta-info">
            <div class="small-flex-item point-value"></div>
            <div class="small-flex-item advisor-name"></div>
        </div>
        <div class="vl"></div>
        <div class="small-flex-container main-mission">
            <div class="small-flex-item mission-name"></div>
            <div class="small-flex-item mission-description"></div>
        </div>
    </div>
    <div class="grid-item" id="mission7" data-mission-id="0">
        <div class="small-flex-container meta-info">
            <div class="small-flex-item point-value"></div>
            <div class="small-flex-item advisor-name"></div>
        </div>
        <div class="vl"></div>
        <div class="small-flex-container main-mission">
            <div class="small-flex-item mission-name"></div>
            <div class="small-flex-item mission-description"></div>
        </div>
    </div>
    <div class="grid-item" id="mission8" data-mission-id="0">
        <div class="small-flex-container meta-info">
            <div class="small-flex-item point-value"></div>
            <div class="small-flex-item advisor-name"></div>
        </div>
        <div class="vl"></div>
        <div class="small-flex-container main-mission">
            <div class="small-flex-item mission-name"></div>
            <div class="small-flex-item mission-description"></div>
        </div>
    </div>
</div>
<i class="fas fa-chevron-right" style="color: #ffffff;" onclick="increment_page()" id="right-button" ></i>

<div id="event-modal" class="modal">
    <div class="modal-content" id="modal-content">
        <span class="close" id="modal-close">&times;</span>
        <div class="mission-info-container" id="mission-info-container">
            <div class="mission-info" id="mission-points">
                <p><i class="fas fa-globe-americas"></i> 0</p>
            </div>
            <div class="mission-info" id="mission-visibility">
                <p><i class="far fa-eye"></i> null</p>
            </div>
            <div class="mission-info" id="mission-time">
                <p><i class="far fa-clock"></i> 0000000000</p>
            </div>
            <div class="mission-info" id="mission-location">
                <p><i class="fas fa-map-marker-alt"></i> 0</p>
            </div>
        </div>
        <h1 class="mission-title" id="mission-title">0</h1>
        <hr>
        <p id="mission-description">No event</p>
    </div>
</div>

<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script>
    // Get the modal element
    var modal = document.getElementById("event-modal");
    console.log(modal);
    var modal_content = modal.querySelector("#modal-content");
    console.log(modal_content);
    var modal_info = modal_content.querySelector("#mission-info-container");

    // Get the div elements to open the modal
    var divs = document.getElementsByClassName("grid-item");

    // Get the close button
    var close_button = document.getElementById("modal-close");

    function update_modal_content(element) {
        console.log("Element:");
        console.log(element);
        mission_id = element.getAttribute("data-mission-id");
        let points = modal_info.querySelector("#mission-points");
        let visibility = modal_info.querySelector("#mission-visibility");
        let time = modal_info.querySelector("#mission-time");
        let location = modal_info.querySelector("#mission-location");
        let title = modal_content.querySelector("#mission-title");
        let description = modal_content.querySelector("#mission-description");
        if (mission_id == 0){
            points.innerHTML = "";
            visibility.innerHTML = "";
            time.innerHTML = "";
            location.innerHTML = "";
            title.innerHTML = "";
            description.innerHTML = "";
            return;
        }
        mission_json = http_get(base_url + "api/missions?id=" + mission_id)

        

        points.innerHTML = '<i class="fas fa-globe-americas"></i> ' + mission_json["value"];
        visibility.innerHTML = '<i class="far fa-eye"></i> ' + http_get(base_url + "api/users?user_id=" + mission_json["visibility"])["username"];
        time.innerHTML = '<i class="far fa-clock"></i> ' + mission_json["time"];
        location.innerHTML = '<i class="fas fa-map-marker-alt"></i> ' + mission_json["location"];
        title.innerHTML = mission_json["name"];
        description.innerHTML = mission_json["description"];
    }
    // Open the modal when a div is clicked
    for (var i = 0; i < divs.length; i++) {
        (function(index) {
            divs[index].addEventListener("click", function() {
            modal.style.display = "block";
            update_modal_content(divs[index]);
            });
        })(i);
    }

    // Close the modal when the close button is clicked
    close_button.addEventListener("click", function() {
        modal.style.display = "none";
    });

    // Close the modal when clicking outside the modal
    window.addEventListener("click", function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    });

    window.addEventListener("keydown", function(event) {
        if (event.key === 'Escape') {
            modal.style.display = "none";
        }
    });
</script>
{% endblock %}

<script>
    document.addEventListener("DOMContentLoaded", function() {
        user_id = parseInt(get_cookie("user_id"));
        const user_info = retrieve_user_information(user_id);
        console.log(user_info);
    });
</script>



{% block footer %}
<p class="footer-text">2023 Alexander Lu</p>
{% endblock %}